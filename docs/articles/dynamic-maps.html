<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dynamic web maps with Mapbox Tiling Service and mapboxer • mapboxapi</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/readable/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Dynamic web maps with Mapbox Tiling Service and mapboxer">
<meta property="og:description" content="mapboxapi">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mapboxapi</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/mapping.html">Mapping with mapboxapi</a>
    </li>
    <li>
      <a href="../articles/navigation.html">Using navigation services with mapboxapi</a>
    </li>
    <li>
      <a href="../articles/creating-tiles.html">Creating and uploading Mapbox vector tilesets</a>
    </li>
    <li>
      <a href="../articles/dynamic-maps.html">Dynamic maps with Mapbox Tiling Service and mapboxer</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/walkerke/mapboxapi" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Dynamic web maps with Mapbox Tiling Service and
mapboxer</h1>
            
      
      
      <div class="hidden name"><code>dynamic-maps.Rmd</code></div>

    </div>

    
    
<p><strong>mapboxapi</strong> version 0.5 added support for the <a href="https://docs.mapbox.com/api/maps/mapbox-tiling-service/" class="external-link">Mapbox
Tiling Service (MTS) API</a>, Mapbox’s recommended tool for publishing
and maintaining vector tile data pipelines. A major benefit to using R
and <strong>mapboxapi</strong> to interact with MTS is that data
pipelines for web maps can be handled directly from R. This vignette
covers an example walkthrough of how to build dynamic web maps with
vector tiles using Mapbox Tiling Service and the <a href="https://crazycapivara.github.io/mapboxer/" class="external-link">mapboxer R package</a>,
a flexible R interface to Mapbox GL JS.</p>
<p>We’ll be making a map of household access to a broadband internet
subscription from the 2016-2020 American Community Survey that varies by
zoom level. The map should show county broadband internet access when
zoomed out, and Census tract level information when zoomed in. We will
accomplish this by preparing a <em>multi-layer tileset</em> that will
store information for both aggregation levels.</p>
<p>To get started, let’s grab some data from the US Census Bureau using
<a href="https://walker-data.com/tidycensus/" class="external-link">tidycensus</a>. This
example assumes you have a Census API key; <a href="https://walker-data.com/tidycensus/articles/basic-usage.html" class="external-link">review
the tidycensus documentation to get set up if you don’t</a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://walker-data.com/tidycensus/" class="external-link">tidycensus</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mapboxapi</span><span class="op">)</span>

<span class="va">county_broadband</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_acs.html" class="external-link">get_acs</a></span><span class="op">(</span>
  geography <span class="op">=</span> <span class="st">"county"</span>,
  variables <span class="op">=</span> <span class="st">"DP02_0154P"</span>,
  year <span class="op">=</span> <span class="fl">2020</span>,
  geometry <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span>

<span class="va">tract_broadband</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_acs.html" class="external-link">get_acs</a></span><span class="op">(</span>
  geography <span class="op">=</span> <span class="st">"tract"</span>,
  variables <span class="op">=</span> <span class="st">"DP02_0154P"</span>,
  state <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">state.abb</span>, <span class="st">"DC"</span><span class="op">)</span>,
  year <span class="op">=</span> <span class="fl">2020</span>,
  geometry <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span></code></pre></div>
<div class="section level2">
<h2 id="publishing-vector-tiles-from-r-with-mapbox-tiling-service">Publishing vector tiles from R with Mapbox Tiling Service<a class="anchor" aria-label="anchor" href="#publishing-vector-tiles-from-r-with-mapbox-tiling-service"></a>
</h2>
<p>Spatial data prepared in R can be published to a user’s Mapbox
account with just a few steps. These steps involve creating <em>tileset
sources</em>, which are datasets stored as raw GeoJSON in a user’s
account; preparing a <em>tileset recipe</em>, which tells Mapbox how to
create vector tiles from the GeoJSON sources; then creating and
publishing <em>vector tilesets</em>. These vector tilesets can be
integrated directly into maps with Mapbox GL JS / the mapboxer R
package, or added to Mapbox styles using Mapbox Studio.</p>
<p>To create tileset sources directly from R, we using the function
<code><a href="../reference/mts_create_source.html">mts_create_source()</a></code>. We’ll create a source for each dataset
that we want to include in our tileset. Assigning the results of
<code><a href="../reference/mts_create_source.html">mts_create_source()</a></code> to an object allows us to capture the
function’s list output, which will be useful when building the tileset
recipe.</p>
<p><code><a href="../reference/mts_create_source.html">mts_create_source()</a></code> requires a Mapbox access token with
secret scope and write access to your Mapbox account. <a href="https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes" class="external-link">Visit
the Mapbox website</a> for more information about access tokens, and
store yours using the <code><a href="../reference/mb_access_token.html">mb_access_token()</a></code> function. You’ll
also supply your own username to the <code>username</code> argument,
rather than use mine. Large datasets can take a few minutes to upload to
your account depending on your connection speed.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">county_source</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mts_create_source.html">mts_create_source</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">county_broadband</span>,
  tileset_id <span class="op">=</span> <span class="st">"county_broadband"</span>,
  username <span class="op">=</span> <span class="st">"kwalkertcu"</span>
<span class="op">)</span>

<span class="va">tract_source</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mts_create_source.html">mts_create_source</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">tract_broadband</span>,
  tileset_id <span class="op">=</span> <span class="st">"tract_broadband"</span>,
  username <span class="op">=</span> <span class="st">"kwalkertcu"</span>
<span class="op">)</span></code></pre></div>
<p>If the upload has succeeded, you’ll get a message like this:</p>
<pre><code>✔ Successfully created tileset source with the ID
'mapbox://tileset-source/kwalkertcu/tract_broadband'.
Use your source ID to build your tileset's recipe.</code></pre>
<p>The tileset ID is also stored in the <code>id</code> element of the
returned list. If your request has failed, you should get an error
message telling you why.</p>
<p>You’ll now use these tileset IDs to prepare a <em>recipe</em>. MTS
recipes are JSON documents that translate tileset sources to vector
tiles. <a href="https://docs.mapbox.com/mapbox-tiling-service/reference/" class="external-link">Preparing
a recipe using the MTS documentation can be complicated</a> as there are
many options, but mapboxapi tries to simplify this process a bit:</p>
<ul>
<li>
<code><a href="../reference/mts_make_recipe.html">mts_make_recipe()</a></code> is the general “recipe creation”
function that takes one or more <em>recipe layers</em> and formats their
configuration appropriately for the MTS API.</li>
<li>Recipe layers can be prepared as an R list by hand, or preferably
with the <code><a href="../reference/recipe_layer.html">recipe_layer()</a></code> function which helps users
understand the range of options available. Feature- and tile- specific
options are available in <code><a href="../reference/feature_options.html">feature_options()</a></code> and
<code><a href="../reference/tile_options.html">tile_options()</a></code>, respectively.<br>
</li>
<li>Some translation of the JSON examples provided by Mapbox and R’s
notation will be necessary. When reading through the MTS documentation,
remember the following:
<ul>
<li>A <em>named list</em> will be translated to a JSON object (curly
braces);</li>
<li>An <em>unnamed list</em> will be translated to a JSON array (square
brackets).</li>
</ul>
</li>
</ul>
<p>Our recipe will include two layers (counties and tracts). A recipe
layer requires a tileset source ID, a minimum zoom level
(<code>minzoom</code>), and maximum zoom level
(<code>maxzoom</code>).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">broadband_recipe</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mts_make_recipe.html">mts_make_recipe</a></span><span class="op">(</span>
  counties <span class="op">=</span> <span class="fu"><a href="../reference/recipe_layer.html">recipe_layer</a></span><span class="op">(</span>
    source <span class="op">=</span> <span class="va">county_source</span><span class="op">$</span><span class="va">id</span>,
    minzoom <span class="op">=</span> <span class="fl">2</span>,
    maxzoom <span class="op">=</span> <span class="fl">7</span>
  <span class="op">)</span>,
  tracts <span class="op">=</span> <span class="fu"><a href="../reference/recipe_layer.html">recipe_layer</a></span><span class="op">(</span>
    source <span class="op">=</span> <span class="va">tract_source</span><span class="op">$</span><span class="va">id</span>,
    minzoom <span class="op">=</span> <span class="fl">7</span>,
    maxzoom <span class="op">=</span> <span class="fl">12</span>,
    tiles <span class="op">=</span> <span class="fu"><a href="../reference/tile_options.html">tile_options</a></span><span class="op">(</span>
      layer_size <span class="op">=</span> <span class="fl">2500</span>
    <span class="op">)</span>
  <span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>Our recipe is relatively simple, as MTS recipes are concerned; we
include the required arguments (though layers can be viewed beyond the
maximum zoom level with overzooming) as well as directions to max out
the layer size for our tracts, ensuring that we can see as many tracts
as possible when zoomed out.</p>
<p>After preparing an MTS recipe, it can be passed to the
<code><a href="../reference/mts_validate_recipe.html">mts_validate_recipe()</a></code> function to make sure that it is
formatted correctly.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/mts_validate_recipe.html">mts_validate_recipe</a></span><span class="op">(</span><span class="va">broadband_recipe</span><span class="op">)</span></code></pre></div>
<p>We get the message <code>✔ Your tileset recipe is valid!</code>; the
function also returns <code>TRUE</code> or <code>FALSE</code> so you can
do error handling in tileset creation pipelines if you wish.</p>
<p>Just two more steps are required to publish the new tileset. We
create the tileset with <code><a href="../reference/mts_create_tileset.html">mts_create_tileset()</a></code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/mts_create_tileset.html">mts_create_tileset</a></span><span class="op">(</span>
  tileset_name <span class="op">=</span> <span class="st">"us_broadband"</span>,
  username <span class="op">=</span> <span class="st">"kwalkertcu"</span>,
  recipe <span class="op">=</span> <span class="va">broadband_recipe</span>
<span class="op">)</span></code></pre></div>
<p>An empty tileset will be created in our Mapbox account. To populate
the tileset, publish it with <code><a href="../reference/mts_publish_tileset.html">mts_publish_tileset()</a></code></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/mts_publish_tileset.html">mts_publish_tileset</a></span><span class="op">(</span>
  tileset_name <span class="op">=</span> <span class="st">"us_broadband"</span>,
  username <span class="op">=</span> <span class="st">"kwalkertcu"</span>
<span class="op">)</span></code></pre></div>
<p>To check on the status of your tileset, you can head over to your
Mapbox account and find your tileset on the <strong>Tilesets</strong>
tab. Once the tileset is published, you’ll be able to browse your
tileset and review its recipe.</p>
<p><img src="img/example_tileset.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="using-vector-tilesets-in-r-with-the-mapboxer-package">Using vector tilesets in R with the mapboxer package<a class="anchor" aria-label="anchor" href="#using-vector-tilesets-in-r-with-the-mapboxer-package"></a>
</h2>
<p>The <a href="https://crazycapivara.github.io/mapboxer/" class="external-link">mapboxer R
package</a> by Stefan Kuethe is a a flexible R interface to <a href="https://docs.mapbox.com/mapbox-gl-js/api/" class="external-link">Mapbox GL JS</a>,
Mapbox’s JavaScript web mapping library with a massive amount of
features. mapboxapi and mapboxer work quite nicely together; mapboxapi
can handle the creation and maintenance of vector tileset pipelines, and
mapboxer then handles the visualization of those tiles.</p>
<p>The <code><a href="https://rdrr.io/pkg/mapboxer/man/add_layer.html" class="external-link">add_layer()</a></code> function in mapboxer allows users to
load remote vector tile layers from their Mapbox account and visualize
them seamlessly in R. Given that we’ve already tiled our county and
tract data, we can visualize all 3000+ US counties and all 80,000+
Census tracts intelligently on the same map.</p>
<p>The code used below (click “Show code” to view it) uses mapboxer to
visualize counties and Census tracts in a scale-dependent manner. At
small zooms (below 7), counties will display; at larger zooms (7 and
up), the view will switch over to Census tracts.</p>
<details><summary>
Show code
</summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/crazycapivara/mapboxer" class="external-link">mapboxer</a></span><span class="op">)</span>

<span class="va">broadband</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mapboxer/man/mapbox_source.html" class="external-link">mapbox_source</a></span><span class="op">(</span>
  type <span class="op">=</span> <span class="st">"vector"</span>,
  url <span class="op">=</span> <span class="st">"mapbox://kwalkertcu.us_broadband"</span>
<span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/mapboxer/man/mapboxer.html" class="external-link">mapboxer</a></span><span class="op">(</span>zoom <span class="op">=</span> <span class="fl">3</span>, style <span class="op">=</span> <span class="va">basemaps</span><span class="op">$</span><span class="va">Mapbox</span><span class="op">$</span><span class="va">light_v10</span>,
         center <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">96</span>, <span class="fl">37.5</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/mapboxer/man/add_layer.html" class="external-link">add_layer</a></span><span class="op">(</span>style <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>
    id <span class="op">=</span> <span class="st">"county"</span>,
    type <span class="op">=</span> <span class="st">"fill"</span>,
    source <span class="op">=</span> <span class="va">broadband</span>,
    <span class="st">"source-layer"</span> <span class="op">=</span> <span class="st">"counties"</span>,
    paint <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>
      <span class="st">"fill-color"</span> <span class="op">=</span> <span class="st">"blue"</span>,
      <span class="st">"fill-opacity"</span> <span class="op">=</span> <span class="fl">0.8</span>
      <span class="op">)</span>,
    maxzoom <span class="op">=</span> <span class="fl">7</span>
    <span class="op">)</span><span class="op">)</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/mapboxer/man/add_layer.html" class="external-link">add_layer</a></span><span class="op">(</span>style <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>
    id <span class="op">=</span> <span class="st">"tracts"</span>,
    type <span class="op">=</span> <span class="st">"fill"</span>,
    source <span class="op">=</span> <span class="va">broadband</span>,
    <span class="st">"source-layer"</span> <span class="op">=</span> <span class="st">"tracts"</span>,
    paint <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>
      <span class="st">"fill-color"</span> <span class="op">=</span> <span class="st">"red"</span>,
      <span class="st">"fill-opacity"</span> <span class="op">=</span> <span class="fl">0.8</span>
      <span class="op">)</span>,
    minzoom <span class="op">=</span> <span class="fl">7</span>
  <span class="op">)</span><span class="op">)</span></code></pre></div>
</details><iframe src="img/dynamic_map.html" width="100%" height="500px" scrolling="no">
</iframe>
<div class="section level3">
<h3 id="styling-vector-tiles-with-mapbox-gl-js-and-mapboxer">Styling vector tiles with Mapbox GL JS and mapboxer<a class="anchor" aria-label="anchor" href="#styling-vector-tiles-with-mapbox-gl-js-and-mapboxer"></a>
</h3>
<p>Mapbox GL JS has many, many more options available for users to
customize styling of their vector tiles. <a href="https://docs.mapbox.com/mapbox-gl-js/style-spec/" class="external-link">While those
options are voluminous</a>, mapboxer can flexibly accommodate most
options within the <code><a href="https://rdrr.io/pkg/mapboxer/man/add_layer.html" class="external-link">add_layer()</a></code> function. Similar to how
recipes are specified in Mapbox Tiling Service, Mapbox style
specifications can be readily translated to R by using named lists for
objects and unnamed lists for arrays.</p>
<p>The example below modifies the map using the following options:</p>
<ul>
<li>An Albers projection appropriate for the United States is used
instead of the default Mercator projection. As of this writing (14
September 2022), this option is only available in a fork of the package,
PR #104; the final implementation may change when the PR is
merged.<br>
</li>
<li>Counties and Census tracts are styled using linear interpolation
inspired by the ColorBrewer YlGnBU palette.</li>
<li>For Census tracts, the <code>"case"</code> option is used for
<code>NA</code> values to make tracts missing data mostly
transparent.</li>
</ul>
<details><summary>
Show code
</summary><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># remotes::install_github("crazycapivara/mapboxer#104")</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/crazycapivara/mapboxer" class="external-link">mapboxer</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/mapboxer/man/mapboxer_use_v2.html" class="external-link">mapboxer_use_v2</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span>

<span class="va">broadband</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mapboxer/man/mapbox_source.html" class="external-link">mapbox_source</a></span><span class="op">(</span>
  type <span class="op">=</span> <span class="st">"vector"</span>,
  url <span class="op">=</span> <span class="st">"mapbox://kwalkertcu.us_broadband"</span>
<span class="op">)</span>

<span class="va">broadband_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mapboxer/man/mapboxer.html" class="external-link">mapboxer</a></span><span class="op">(</span>zoom <span class="op">=</span> <span class="fl">3</span>, style <span class="op">=</span> <span class="va">basemaps</span><span class="op">$</span><span class="va">Mapbox</span><span class="op">$</span><span class="va">light_v10</span>,
         center <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">96</span>, <span class="fl">37.5</span><span class="op">)</span>,
         projection <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>
           name <span class="op">=</span> <span class="st">"albers"</span>,
           center <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">96</span>, <span class="fl">37.5</span><span class="op">)</span>,
           parallels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">29.5</span>, <span class="fl">45.5</span><span class="op">)</span>
         <span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/mapboxer/man/add_layer.html" class="external-link">add_layer</a></span><span class="op">(</span>style <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>
    id <span class="op">=</span> <span class="st">"county"</span>,
    type <span class="op">=</span> <span class="st">"fill"</span>,
    source <span class="op">=</span> <span class="va">broadband</span>,
    <span class="st">"source-layer"</span> <span class="op">=</span> <span class="st">"counties"</span>,
    paint <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>
      <span class="st">"fill-color"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>
        <span class="st">"interpolate"</span>,
        <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"linear"</span><span class="op">)</span>,
        <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"get"</span>, <span class="st">"estimate"</span><span class="op">)</span>,
        <span class="fl">33</span>,
        <span class="st">'#edf8b1'</span>,
        <span class="fl">65</span>,
        <span class="st">'#7fcdbb'</span>,
        <span class="fl">97</span>,
        <span class="st">'#2c7fb8'</span>
      <span class="op">)</span>,
      <span class="st">"fill-opacity"</span> <span class="op">=</span> <span class="fl">0.8</span>
    <span class="op">)</span>,
    maxzoom <span class="op">=</span> <span class="fl">7</span>
  <span class="op">)</span>,
  popup <span class="op">=</span> <span class="st">"{{NAME}}&lt;br/&gt;Estimate: {{estimate}}%"</span><span class="op">)</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/mapboxer/man/add_layer.html" class="external-link">add_layer</a></span><span class="op">(</span>style <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>
    id <span class="op">=</span> <span class="st">"tracts"</span>,
    type <span class="op">=</span> <span class="st">"fill"</span>,
    source <span class="op">=</span> <span class="va">broadband</span>,
    <span class="st">"source-layer"</span> <span class="op">=</span> <span class="st">"tracts"</span>,
    paint <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>
      <span class="st">"fill-color"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>
        <span class="st">"interpolate"</span>,
        <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"linear"</span><span class="op">)</span>,
        <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"get"</span>, <span class="st">"estimate"</span><span class="op">)</span>,
        <span class="fl">33</span>,
        <span class="st">'#edf8b1'</span>,
        <span class="fl">65</span>,
        <span class="st">'#7fcdbb'</span>,
        <span class="fl">97</span>,
        <span class="st">'#2c7fb8'</span>
      <span class="op">)</span>,
      <span class="st">"fill-opacity"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>
        <span class="st">"case"</span>,
        <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"=="</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"get"</span>, <span class="st">"estimate"</span><span class="op">)</span>, <span class="cn">NA</span><span class="op">)</span>,
        <span class="fl">0.1</span>,
        <span class="fl">0.8</span>
      <span class="op">)</span>
    <span class="op">)</span>,
    minzoom <span class="op">=</span> <span class="fl">7</span>
  <span class="op">)</span>,
  popup <span class="op">=</span> <span class="st">"{{NAME}}&lt;br/&gt;Estimate: {{estimate}}%"</span><span class="op">)</span></code></pre></div>
</details><iframe src="img/styled_map.html" width="100%" height="500px" scrolling="no">
</iframe>
</div>
<div class="section level3">
<h3 id="adding-a-custom-built-legend">Adding a custom-built legend<a class="anchor" aria-label="anchor" href="#adding-a-custom-built-legend"></a>
</h3>
<p>While mapboxer does not yet have official support for legends, the
beauty of htmlwidgets is that you can customize your HTML output with
some extra HTML and CSS. I’ve built a custom legend to be placed over
the map <a href="https://docs.mapbox.com/help/tutorials/show-changes-over-time/" class="external-link">by
modifying a legend example from the Mapbox documentation</a> and adding
it to my mapboxer map with <code><a href="https://rdrr.io/pkg/htmlwidgets/man/prependContent.html" class="external-link">htmlwidgets::prependContent()</a></code>
and <code><a href="https://rdrr.io/pkg/htmlwidgets/man/prependContent.html" class="external-link">htmlwidgets::appendContent()</a></code>.</p>
<details><summary>
Show code
</summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">style</span> <span class="op">&lt;-</span> <span class="fu">htmltools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/HTML.html" class="external-link">HTML</a></span><span class="op">(</span>
  <span class="st">"
  &lt;style&gt;
    @import url('https://fonts.googleapis.com/css2?family=Roboto&amp;display=swap');

    h2 {
    font-size: 14px;
    font-family: 'Roboto';
    line-height: 20px;
    margin-bottom: 10px;
    }

    #legend {
    position: fixed;
    border-radius: 10px;
    top:10px;
    left:10px;
    margin: 10px;
    width: 120px;
    background-color: #ffffff80;
    padding: 10px 20px;
    z-index: 1002;
    }

    .content {
    margin-bottom: 20px;
    }

    .row {
    height: 12px;
    width: 100%;
    }

    .colors {
    background: linear-gradient(
    to right,
    #edf8b1,
    #7fcdbb,
    #2c7fb8
    );
    margin-bottom: 5px;
    }

    .label {
    width: 30%;
    display: inline-block;
    text-align: center;
    font-family: 'Roboto';
    }
    &lt;/style&gt;
  "</span>
<span class="op">)</span>

<span class="va">legend</span> <span class="op">&lt;-</span> <span class="fu">htmltools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/HTML.html" class="external-link">HTML</a></span><span class="op">(</span>
  <span class="st">'
&lt;div id="legend"&gt;
&lt;div class="content"&gt;
&lt;h2&gt;Households with broadband access&lt;/h2&gt;
&lt;div class="row colors"&gt;&lt;/div&gt;
&lt;div class="row labels"&gt;
&lt;div class="label"&gt;33%&lt;/div&gt;
&lt;div class="label"&gt;65%&lt;/div&gt;
&lt;div class="label"&gt;97%&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
  '</span>
<span class="op">)</span>

<span class="va">broadband_map</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu">htmlwidgets</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/htmlwidgets/man/prependContent.html" class="external-link">prependContent</a></span><span class="op">(</span><span class="va">style</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu">htmlwidgets</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/htmlwidgets/man/prependContent.html" class="external-link">appendContent</a></span><span class="op">(</span><span class="va">legend</span><span class="op">)</span></code></pre></div>
</details><iframe src="img/map_with_legend.html" width="100%" height="500px" scrolling="no">
</iframe>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Kyle Walker.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
