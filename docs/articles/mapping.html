<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mapping with mapboxapi • mapboxapi</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/readable/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Mapping with mapboxapi">
<meta property="og:description" content="mapboxapi">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mapboxapi</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.5.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/mapping.html">Mapping with mapboxapi</a>
    </li>
    <li>
      <a href="../articles/navigation.html">Using navigation services with mapboxapi</a>
    </li>
    <li>
      <a href="../articles/creating-tiles.html">Creating and uploading Mapbox vector tilesets</a>
    </li>
    <li>
      <a href="../articles/dynamic-maps.html">Dynamic maps with Mapbox Tiling Service and mapboxer</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/walkerke/mapboxapi" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="mapping_files/htmlwidgets-1.6.1/htmlwidgets.js"></script><link href="mapping_files/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="mapping_files/leaflet-1.3.1/leaflet.js"></script><link href="mapping_files/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="mapping_files/proj4-2.6.2/proj4.min.js"></script><script src="mapping_files/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="mapping_files/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="mapping_files/leaflet-binding-2.1.1/leaflet.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Mapping with mapboxapi</h1>
            
      
      
      <div class="hidden name"><code>mapping.Rmd</code></div>

    </div>

    
    
<p>While <strong>mapboxapi</strong> is not an interface to <a href="https://docs.mapbox.com/mapbox-gl-js/api/" class="external-link">Mapbox GL JS</a>, the
Mapbox JavaScript library for web mapping, it does have functionality
for map-making and visualization in combination with your spatial
analysis workflows.</p>
<div class="section level2">
<h2 id="interactive-and-static-mapping-with-mapbox-styles">Interactive and static mapping with Mapbox styles<a class="anchor" aria-label="anchor" href="#interactive-and-static-mapping-with-mapbox-styles"></a>
</h2>
<p>Let’s say that you’ve designed a custom map style in Mapbox Studio
that you’d like to incorporate into your R projects. In this example,
I’ll use Mapbox’s <a href="https://apps.mapbox.com/cartogram/" class="external-link">Cartogram
tool</a> to generate a custom map style from the R logo.</p>
<p><img src="img/cartogram.png" style="width: 800px"></p>
<p>I can retrieve the style ID from my Mapbox account, or use the
<code><a href="../reference/get_style.html">list_styles()</a></code> function in <strong>mapboxapi</strong> to get
the ID. With the style ID and my Mapbox username, the
<code><a href="../reference/addMapboxTiles.html">addMapboxTiles()</a></code> function allows for direct incorporation
of this style in an R Leaflet project.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/leaflet/" class="external-link">leaflet</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mapboxapi</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/leaflet.html" class="external-link">leaflet</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/leaflet/man/leaflet-imports.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="../reference/addMapboxTiles.html">addMapboxTiles</a></span><span class="op">(</span>style_id <span class="op">=</span> <span class="st">"ckb83x2ur02oa1hpiq9zdt1i2"</span>,
                 username <span class="op">=</span> <span class="st">"kwalkertcu"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/leaflet/man/leaflet-imports.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/map-methods.html" class="external-link">setView</a></span><span class="op">(</span>lng <span class="op">=</span> <span class="op">-</span><span class="fl">74.0051</span>,
          lat <span class="op">=</span> <span class="fl">40.7251</span>,
          zoom <span class="op">=</span> <span class="fl">13</span><span class="op">)</span></code></pre></div>
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-b2a61c302db34507f31f" style="width:700px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-b2a61c302db34507f31f">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["https://api.mapbox.com/styles/v1/kwalkertcu/ckb83x2ur02oa1hpiq9zdt1i2/tiles/{z}/{x}/{y}?access_token=pk.eyJ1Ijoia3dhbGtlcnRjdSIsImEiOiJMRk9JSmRvIn0.l1y2jHZ6IARHM_rA1-X45A",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"https://www.mapbox.com/about/maps/\">Mapbox<\/a> &copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap<\/a> <strong><a href=\"https://www.mapbox.com/map-feedback/\" target=\"_blank\">Improve this map<\/a><\/strong>"}]}],"setView":[[40.7251,-74.0051],13,[]]},"evals":[],"jsHooks":[]}</script><p>In some cases, you may be more interested in a static map rather than
an interactive one. Static maps can be created with
<strong>mapboxapi</strong> in two ways. Static maps can be generated
directly in <strong>mapboxapi</strong> with the
<code><a href="../reference/static_mapbox.html">static_mapbox()</a></code> function. This function accepts sf
polygon/linestring (of limited size) or marker overlays.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">points_of_interest</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>
  longitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">73.99405</span>, <span class="op">-</span><span class="fl">74.00616</span>, <span class="op">-</span><span class="fl">73.99577</span>, <span class="op">-</span><span class="fl">74.00761</span><span class="op">)</span>,
  latitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">40.72033</span>, <span class="fl">40.72182</span>, <span class="fl">40.71590</span>, <span class="fl">40.71428</span><span class="op">)</span>
  <span class="op">)</span>

<span class="va">prepped_pois</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prep_overlay_markers.html">prep_overlay_markers</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">points_of_interest</span>,
  marker_type <span class="op">=</span> <span class="st">"pin-l"</span>,
  label <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,
  color <span class="op">=</span> <span class="st">"#fff"</span>
<span class="op">)</span>

<span class="va">map</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/static_mapbox.html">static_mapbox</a></span><span class="op">(</span>
  style_id <span class="op">=</span> <span class="st">"ckb83x2ur02oa1hpiq9zdt1i2"</span>,
  username <span class="op">=</span> <span class="st">"kwalkertcu"</span>,
  overlay_markers <span class="op">=</span> <span class="va">prepped_pois</span>, 
  width <span class="op">=</span> <span class="fl">1200</span>,
  height <span class="op">=</span> <span class="fl">800</span>
<span class="op">)</span>

<span class="va">map</span></code></pre></div>
<p><img src="img/static1.png" width="600"></p>
<p>The output is an object from the <a href="https://github.com/ropensci/magick" class="external-link">magick</a> R package that can
be further customized with <strong>magick</strong> functions.</p>
<p>Alternatively, users might be interested in retrieving static tiles
for use as a basemap in tmap or ggplot2 maps. For an input sf object,
the <code><a href="../reference/get_static_tiles.html">get_static_tiles()</a></code> function will retrieve static tiles
as a raster object around the input. The example below fetches the
standard Light Mapbox basemap and uses it as a basemap for demographic
data obtained with tidycensus.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://walker-data.com/tidycensus/" class="external-link">tidycensus</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-tmap/tmap" class="external-link">tmap</a></span><span class="op">)</span>

<span class="va">travis_income</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_acs.html" class="external-link">get_acs</a></span><span class="op">(</span>
  geography <span class="op">=</span> <span class="st">"tract"</span>,
  variables <span class="op">=</span> <span class="st">"B19013_001"</span>,
  state <span class="op">=</span> <span class="st">"TX"</span>,
  county <span class="op">=</span> <span class="st">"Travis"</span>,
  geometry <span class="op">=</span> <span class="cn">TRUE</span>,
  year <span class="op">=</span> <span class="fl">2019</span>
<span class="op">)</span>

<span class="va">travis_tiles</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_static_tiles.html">get_static_tiles</a></span><span class="op">(</span>
  location <span class="op">=</span> <span class="va">travis_income</span>,
  zoom <span class="op">=</span> <span class="fl">9</span>,
  style_id <span class="op">=</span> <span class="st">"light-v9"</span>,
  username <span class="op">=</span> <span class="st">"mapbox"</span>
<span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">travis_tiles</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_raster.html" class="external-link">tm_rgb</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">travis_income</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html" class="external-link">tm_polygons</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"estimate"</span>,  
              alpha <span class="op">=</span> <span class="fl">0.5</span>, palette <span class="op">=</span> <span class="st">"cividis"</span>, 
              title <span class="op">=</span> <span class="st">"Median household income\n2015-2019 ACS"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html" class="external-link">tm_layout</a></span><span class="op">(</span>legend.outside <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_credits.html" class="external-link">tm_credits</a></span><span class="op">(</span><span class="st">"Basemap © Mapbox, © OpenStreetMap"</span>, position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"RIGHT"</span>, <span class="st">"BOTTOM"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="mapping_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="reading-vector-tile-data-into-r">Reading vector tile data into R<a class="anchor" aria-label="anchor" href="#reading-vector-tile-data-into-r"></a>
</h2>
<p>Mapbox styles on interactive maps are generally delivered as vector
tiles, and can be visualized in this way in R with the <a href="https://symbolixau.github.io/mapdeck/articles/mapdeck.html" class="external-link">mapdeck
R package</a> by providing style information obtained from Mapbox
Studio. <strong>mapboxapi</strong> also allows you to read data from
vector tilesets directly into R as sf objects.</p>
<p>For example, let’s say I want to grab data from a vector tileset
nearby to one of the points of interest I just mapped. This can be
accomplished with the <code><a href="../reference/get_vector_tiles.html">get_vector_tiles()</a></code> function and an
appropriate tileset ID, which can be obtained from your Mapbox account.
The location to query can be a coordinate pair, an address, or an sf
object.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">vector_extract</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_vector_tiles.html">get_vector_tiles</a></span><span class="op">(</span>
  tileset_id <span class="op">=</span> <span class="st">"mapbox.mapbox-streets-v8"</span>,
  location <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">73.99405</span>, <span class="fl">40.72033</span><span class="op">)</span>,
  zoom <span class="op">=</span> <span class="fl">15</span>
<span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">vector_extract</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] "building"           "landuse"            "place_label"       </span>
<span class="co">## [4] "poi_label"          "road"               "structure"         </span>
<span class="co">## [7] "transit_stop_label" "water"</span></code></pre>
<p>I get back a number of layers, including roads, labels, and
buildings, from the vector tile at zoom 15 that intersects my input
coordinates. All of these elements are processed as sf objects that can
be mapped with R tools:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">vector_extract</span><span class="op">$</span><span class="va">building</span><span class="op">$</span><span class="va">polygons</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="mapping_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Kyle Walker.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
